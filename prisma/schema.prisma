// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Configuration Tables
model TimeframeConfig {
  id            String        @id @default(uuid())
  name          String        @db.VarChar(50)
  displayOrder  Int
  isActive      Boolean       @default(true)
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  journalEntries JournalEntry[]

  @@map("timeframe_configs")
}

model PatternConfig {
  id            String        @id @default(uuid())
  name          String        @db.VarChar(100)
  description   String?
  displayOrder  Int
  isActive      Boolean       @default(true)
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  journalEntries JournalEntry[]

  @@map("pattern_configs")
}

model TooltipConfig {
  id          String   @id @default(uuid())
  key         String   @unique
  text        String   @db.VarChar(200)
  maxLength   Int      @default(50) @map("max_length")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("tooltip_configs")
}

model SourceConfig {
  id            String        @id @default(uuid())
  name          String        @db.VarChar(100)
  description   String?
  displayOrder  Int
  isActive      Boolean       @default(true)
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  ideas         Idea[]

  @@map("source_configs")
}

model StrategyConfig {
  id                        String        @id @default(uuid())
  name                      String        @db.VarChar(100)
  tagValue                  String        @db.VarChar(50) @map("tag_value")
  sourcingValues            Json?         @map("sourcing_values")
  recordingSystem           String?       @db.VarChar(500) @map("recording_system")
  enterCriteria             String?       @db.VarChar(500) @map("enter_criteria")
  earlyEntryCriteria        String?       @db.VarChar(500) @map("early_entry_criteria")
  exitCriteria              String?       @db.VarChar(500) @map("exit_criteria")
  confirmationCriteria      String?       @db.VarChar(500) @map("confirmation_criteria")
  qualityConsiderations     String?       @db.VarChar(500) @map("quality_considerations")
  qualityCriteria           String?       @db.VarChar(500) @map("quality_criteria")
  kaizen                    String?       @db.VarChar(500)
  executionReviewCriteria   String?       @db.VarChar(500) @map("execution_review_criteria")
  retrospectivePeriod       Int?          @map("retrospective_period")
  taggingSystem             String?       @db.VarChar(500) @map("tagging_system")
  displayOrder              Int
  isActive                  Boolean       @default(true)
  createdAt                 DateTime      @default(now()) @map("created_at")
  updatedAt                 DateTime      @updatedAt @map("updated_at")
  ideas                     Idea[]

  @@map("strategy_configs")
}

// Ideas Configuration
model IdeasExpiryConfig {
  id          String   @id @default(uuid())
  expiryDays  Int      @default(365) @map("expiry_days")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("ideas_expiry_config")
}

model StockMultiplierConfig {
  id          String   @id @default(uuid())
  ticker      String   @unique @db.VarChar(20)
  multiplier  Decimal  @db.Decimal(10, 2)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("stock_multiplier_configs")
}

// Main Journal Entries Table
model JournalEntry {
  id                      String        @id @default(uuid())
  createdAt              DateTime      @default(now()) @map("created_at")
  updatedAt              DateTime      @updatedAt @map("updated_at")
  entryDate              DateTime      @map("entry_date")
  ticker                 String        @db.VarChar(20)
  price                  Decimal       @db.Decimal(10, 2)
  timeframe              TimeframeConfig? @relation(fields: [timeframeId], references: [id])
  timeframeId            String?       @map("timeframe_id")
  direction              Direction
  sentiment              Sentiment
  pattern                PatternConfig? @relation(fields: [patternId], references: [id])
  patternId              String?       @map("pattern_id")
  support                Decimal?      @db.Decimal(10, 2)
  resistance             Decimal?      @db.Decimal(10, 2)
  comments               String?
  gamePlan               String?       @map("game_plan")
  isWeeklyOnePagerEligible Boolean     @default(false) @map("is_weekly_one_pager_eligible")
  
  // Retrospectives
  retro7DStatus          RetroStatus   @default(pending) @map("retro_7d_status")
  retro7DCompletedAt     DateTime?     @map("retro_7d_completed_at")
  retro7DOutcome         RetroOutcome? @map("retro_7d_outcome")
  retro7DNotes           String?       @map("retro_7d_notes")
  
  retro30DStatus         RetroStatus   @default(pending) @map("retro_30d_status")
  retro30DCompletedAt    DateTime?     @map("retro_30d_completed_at")
  retro30DOutcome        RetroOutcome? @map("retro_30d_outcome")
  retro30DNotes          String?       @map("retro_30d_notes")

  @@map("journal_entries")
  @@index([entryDate])
  @@index([ticker])
  @@index([timeframeId])
  @@index([patternId])
}

// Ideas Table
model Idea {
  id                String        @id @default(uuid())
  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")
  ticker            String        @db.VarChar(20)
  date              DateTime      @default(now())
  currentPrice      Decimal       @map("current_price") @db.Decimal(10, 2)
  targetEntry       Decimal       @map("target_entry") @db.Decimal(10, 2)
  targetPrice       Decimal       @map("target_price") @db.Decimal(10, 2)
  stop              Decimal       @db.Decimal(10, 2)
  rrRatio           Decimal       @map("rr_ratio") @db.Decimal(5, 2)
  tradeDirection    TradeDirection @map("trade_direction")
  strategy          StrategyConfig? @relation(fields: [strategyId], references: [id])
  strategyId        String?       @map("strategy_id")
  market            MarketDirection
  relative          Decimal       @db.Decimal(5, 2)
  oneHourTrend      TrendDirection @map("one_hour_trend")
  oneHourCloud      CloudPosition @map("one_hour_cloud")
  intendedPosition  Int           @map("intended_position")
  toWinMoney        Decimal       @map("to_win_money") @db.Decimal(12, 2)
  moneyRisk         Decimal       @map("money_risk") @db.Decimal(12, 2)
  notes             String?
  sourced           SourceConfig? @relation(fields: [sourceId], references: [id])
  sourceId          String?       @map("source_id")
  quality           Quality
  status            IdeaStatus    @default(active)
  tradeId           String?       @map("trade_id")
  expiresAt         DateTime      @map("expires_at")

  @@map("ideas")
  @@index([ticker])
  @@index([date])
  @@index([status])
  @@index([expiresAt])
}

// Enums
enum Direction {
  Bullish
  Bearish
}

enum Sentiment {
  Bullish
  Neutral
  Bearish
}

enum RetroStatus {
  pending
  completed
  overdue
}

enum RetroOutcome {
  win
  loss
}

// Ideas Enums
enum TradeDirection {
  Long
  Short
}

enum MarketDirection {
  Bullish
  Bearish
}

enum TrendDirection {
  Bullish
  Bearish
}

enum CloudPosition {
  Above
  Below
}

enum Quality {
  HQ
  MQ
  LQ
}

enum IdeaStatus {
  active
  inactive
  expired
} 